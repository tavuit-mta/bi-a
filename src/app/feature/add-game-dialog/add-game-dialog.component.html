<h2 mat-dialog-title>
  {{ isViewMode ? !isServerMode ? 'Xem ván đấu' : 'Sửa Ván Đấu' : 'Thêm Ván Đấu' }}
</h2>
<mat-dialog-content [formGroup]="form" class="add-game-dialog-content">
  <mat-form-field class="full-width winner-select" appearance="fill" subscriptSizing="dynamic">
    <mat-select class="winner-input" formControlName="winner" placeholder="Chọn người thắng">
      @for (player of players; track player) {
      <mat-option [value]="player.index">{{player.name}}</mat-option>
      }
    </mat-select>
  </mat-form-field>
  <ng-container *ngIf="form.value?.winner !== null && form.value?.winner !== undefined">
    <div class="winner-info">
      <form [formGroup]="losersForm">
        <div *ngFor="let idx of sortedPlayerIndexes" class="player-panel">
          <mat-accordion>
            <mat-expansion-panel [expanded]="panelOpenState() === idx" (opened)="togglePanel(idx)"
              class="custom-expansion-panel">
              <mat-expansion-panel-header [ngClass]="{'is-error': isError(idx)}">
                <mat-panel-title class="custom-panel-title"> {{ players[idx].name }} </mat-panel-title>
                <mat-panel-description>
                  {{ totalPoints[idx]}}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="player-row">
                <div class="custom-form-row" (click)="remainingPoint.focus()">
                  <label for="remainingPoint" class="custom-label">Số lá còn lại</label>
                  <input #remainingPoint id="remainingPoint" type="number" class="custom-input" [formControl]="remainingForm(idx)"
                    numberPattern pattern="[0-9]*"/>
                </div>
                <div class="extended-per-player" [formGroup]="extendedForm(idx)">
                  <div class="extended-row">
                    <div class="custom-form-row" (click)="commonPoints.focus()">
                      <label for="commonPoints" class="custom-label">Điểm chung</label>
                      <input #commonPoints id="commonPoints" type="number" class="custom-input" formControlName="commonPoints"
                        numberPattern pattern="[0-9]*"/>
                    </div>
                  </div>

                  <div class="extended-row">
                    <div class="penalty-payers-list"
                      *ngFor="let payerCtrl of getPenaltyPayersFormArray(idx).controls; let j = index">
                      <div class="penalty-row" *ngIf="idx !== j">
                        <div class="custom-form-row" *ngIf="idx !== j" (click)="penaltyInput.focus()">
                          <label for="penalty-{{ players[j].index }}" class="custom-label">Điểm {{ players[j].name }}
                            đền</label>
                          <input #penaltyInput name="penalty-{{ players[j].index }}" type="number" class="custom-input"
                            [formControl]="penaltyControl(payerCtrl, 'amount')" pattern="[0-9]*" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </form>
    </div>
  </ng-container>
</mat-dialog-content>

<!-- <mat-dialog-actions align="end">
  <button mat-raised-button color="warn" (click)="cancel()">Hủy</button>
  <button mat-raised-button color="primary" (click)="save()" *ngIf="isServerMode">
    {{ isEditMode ? 'Lưu' : 'Cập nhật' }}
  </button>
</mat-dialog-actions> -->

<mat-dialog-actions>
  <div class="add-player-actions">
    <button mat-raised-button color="warn" (click)="cancel()">Hủy</button>
    <button mat-raised-button color="primary" (click)="save()" *ngIf="isServerMode">
      {{ isEditMode ? 'Lưu' : 'Cập nhật' }}
    </button>
  </div>
</mat-dialog-actions>